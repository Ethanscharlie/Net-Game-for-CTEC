<html>
    <body>
		<h1>Pictionary</h1>
        <div id="MyID"></div>

		<canvas id="myCanvas" width="400" height="400" style="border:1px solid #000000;"></canvas>
        <div id="responseDiv"></div>

        <script>
			let userID = 0;

			let canvas = document.getElementById("myCanvas");
			let ctx = canvas.getContext("2d");

			let drawing = false;

            function sendGetRequest() {
                fetch(`/getgamedata?canvas=${canvas.toDataURL()}`)
                    .then(response => response.text())
                    .then(data => {
						let splitData = data.split("\n");

						userID = splitData[0].replace("yourID=");
						document.getElementById("MyID").innerText = `My ID: ${userID}`;

						let drawingPlayerID = splitData[1].replace("drawingPlayerID=", "");
						let newCanvasData = splitData[2].replace("canvas=", "");

						document.getElementById('responseDiv').innerText = `Drawing Player ID = ${drawingPlayerID}\nCanvas Data = ${newCanvasData}`;

						if (userID != drawingPlayerID) {
							let image = new Image();
							image.onload = function() {
								ctx.clearRect(0, 0, canvas.width, canvas.height);
								ctx.drawImage(image, 0, 0);
							};
							image.src = newCanvasData;
						}
                    })
                    .catch(error => console.error('Error:', error));
            }
			
			canvas.addEventListener('mousedown', (e) => {
			  drawing = true;
			  ctx.beginPath();
			  ctx.moveTo(e.offsetX, e.offsetY);
			});
		 
			canvas.addEventListener('mousemove', (e) => {
			  if (drawing) {
			    ctx.lineTo(e.offsetX, e.offsetY);
			    ctx.stroke();
			  }
			});
		 
			canvas.addEventListener('mouseup', () => {
			  drawing = false;
			  ctx.closePath();
			});
		 
			canvas.addEventListener('mouseleave', () => {
			  drawing = false;
			  ctx.closePath();
			});

			window.setInterval(function(){
				document.getElementById('MyID').innerText = `My ID: ${userID}`;
				sendGetRequest();
			}, 100);
        </script>
    </body>
</html>