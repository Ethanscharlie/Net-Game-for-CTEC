<html>
	<head>
		<style>
			body {
				background-color: burlywood;
				margin-top: 50px;
			}

			.align-left {
				display: inline-block;
				vertical-align: top;
				margin: 20px;
			}

			.align-right {
			}

			#gamePanel {
				background-color: gray;
				width: 80%;
				margin: auto; 
				padding: 10px;
			}

			#guessPanel {
				background-color: lightblue;
				display: inline-block;
				margin: 20px;
				vertical-align: top;
				height: 600px;
			}

			canvas {
				background-color: white;
				margin: 30px;
				display: inline-block;
			}

			#guessForm {
			}
		</style>
	</head>

    <body>
		<div id="gamePanel">
			<h1 id="gameTitle">Pictionary</h1>
  	      	<div id="MyID"></div>
  	      	<div id="responseDiv"></div>

			<div id="drawInputPanel" class="align-left">
				<div class="slidecontainer">
					<input type="range" min="1" max="20" value="1" class="slider" id="strokeWidthRange">
				</div>

				<button onclick="setPenColor(`blue`)">Set Color Blue</button><br>
				<button onclick="setPenColor(`green`)">Set Color Green</button><br>
				<button onclick="setPenColor(`red`)">Set Color Red</button><br>
				<button onclick="setPenColor(`yellow`)">Set Color Yellow</button><br>
				<button onclick="setPenColor(`orange`)">Set Color Orange</button><br>
				<button onclick="setPenColor(`white`)">Set Color White</button><br>
				<button onclick="setPenColor(`black`)">Set Color Black</button><br>
				<button onclick="clearCanvas()">Clear Canvas</button><br>
			</div>

			<canvas id="myCanvas" width="800" height="600" style="border:1px solid #000000;"></canvas>

			<div class="align-right" id="guessPanel">
				<div id="guesses">
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
					<p>Message</p>
				</div>
				
				<form id="guessForm">
					<input type="text" id="guess" name="guess">
					<input type="submit" value="Submit">
				</form> 
			</div>
		</div>

        <script>
			let userID = 0;

			let canvas = document.getElementById("myCanvas");
			let ctx = canvas.getContext("2d");
			let strokeWidthRange = document.getElementById("strokeWidthRange");

			let drawing = false;

			clearCanvas();

			strokeWidthRange.oninput = function() {
				ctx.lineWidth = this.value;
			};

			document.getElementById("guessForm").addEventListener("submit", (e) => {
				e.preventDefault();

				let guess = document.getElementById("guess").value;
				document.getElementById("guess").value = "";
                fetch(`/guess?guess=${guess}`)
                    .then(response => response.text())
                    .then(data => {})
                    .catch(error => console.error('Error:', error));
			});

            function sendGetRequest() {
                fetch(`/getgamedata?canvas=${canvas.toDataURL()}`)
                    .then(response => response.text())
                    .then(data => {
						let splitData = data.split("\n");

						userID = splitData[0].replace("yourID=", "");
						document.getElementById("MyID").innerText = `My ID: ${userID}`;

						let drawingPlayerID = splitData[1].replace("drawingPlayerID=", "");
						let newCanvasData = splitData[2].replace("canvas=", "");
						let word = splitData[3].replace("word=", "");

						if (newCanvasData == "clear") {
							clearCanvas();
						}

						document.getElementById('responseDiv').innerText = "";
						if (drawingPlayerID == userID) {
							document.getElementById('responseDiv').innerText = "YOU are drawing";
							document.getElementById('responseDiv').innerText += `     ${word}`;
						} else {
							document.getElementById('responseDiv').innerText = "YOU are guessing";
						}

						if (userID != drawingPlayerID) {
							let image = new Image();
							image.onload = function() {
								ctx.clearRect(0, 0, canvas.width, canvas.height);
								ctx.drawImage(image, 0, 0);
							};
							image.src = newCanvasData;
						}
                    })
                    .catch(error => console.error('Error:', error));
            }

			function setPenColor(colorName){
				ctx.strokeStyle = colorName;
			}

			function clearCanvas()
			{
				ctx.clearRect(0, 0, canvas.width, canvas.height);
			}
			
			canvas.addEventListener('mousedown', (e) => {
			  drawing = true;
			  ctx.beginPath();
			  ctx.moveTo(e.offsetX, e.offsetY);
			});
		 
			canvas.addEventListener('mousemove', (e) => {
			  if (drawing) {
			    ctx.lineTo(e.offsetX, e.offsetY);
			    ctx.stroke();
			  }
			});
		 
			canvas.addEventListener('mouseup', () => {
			  drawing = false;
			  ctx.closePath();
			});
		 
			canvas.addEventListener('mouseleave', () => {
			  drawing = false;
			  ctx.closePath();
			});

			window.setInterval(function(){
				document.getElementById('MyID').innerText = `My ID: ${userID}`;
				sendGetRequest();
			}, 100);
        </script>
    </body>
</html>