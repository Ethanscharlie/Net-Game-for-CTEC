<html>
    <body>
		  <h1>Hello, World!</h1>
        <div id="responseDiv"></div>

		<canvas id="myCanvas" width="400" height="400" style="border:1px solid #000000;"></canvas>


        <script>
			let userID = USERIDHERE;

			let mouseX = 69;
			let mouseY = 69;

			let otherPlayers = {};

			let canvas = document.getElementById("myCanvas");
			let ctx = canvas.getContext("2d");

			document.addEventListener('mousemove', (event) => {
				const rect = canvas.getBoundingClientRect();
  				const x = event.clientX - rect.left;
  				const y = event.clientY - rect.top;

				mouseX = x;
				mouseY = y;
			});

            function sendGetRequest() {
                fetch(`/getgamedata?id=${userID}&x=${mouseX}&y=${mouseY}`)
                    .then(response => response.text())
                    .then(data => {
                        console.log('Response from get req:', data);
						document.getElementById('responseDiv').innerText = 'Last Response: ' + data;

						let playerDatas = data.split("\n");
						playerDatas.forEach(playerData => {
							if (playerData != "") {
								let items = playerData.split("&");
								let id = items[0].replace("id=", "");
								let x = items[1].replace("x=", "");
								let y = items[2].replace("y=", "");
								otherPlayers[id] = {"x": x, "y": y};
							}
						});
						console.log(otherPlayers);
                    })
                    .catch(error => console.error('Error:', error));
            }

			function draw() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);

				ctx.fillStyle = 'orange';
				for (const [id, pos] of Object.entries(otherPlayers)) {
					ctx.fillRect(pos["x"], pos["y"], 30, 30);
				}

				ctx.fillStyle = 'blue';
				ctx.fillRect(mouseX, mouseY, 30, 30);

			}

			window.setInterval(function(){
				sendGetRequest();
			}, 100);

			window.setInterval(function(){
				draw();
			}, 1);
        </script>
    </body>
</html>